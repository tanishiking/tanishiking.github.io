<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>IME event handling in JavaScript cross-browser (2017) | Rikito Taniguchi</title><meta name=keywords content="javascript">
<meta name=description content="In 2017, when CompositionEvent is supported by many major browsers, I thought it would be easy to implement a small input completion function that supports Japanese input in JavaScript, but the details of the implementation differed depending on the browser...">
<meta name=author content="Rikito Taniguchi">
<link rel=canonical href=https://tanishiking.github.io/posts/sample/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://tanishiking.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://tanishiking.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://tanishiking.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://tanishiking.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://tanishiking.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.93.0">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="IME event handling in JavaScript cross-browser (2017)">
<meta property="og:description" content="In 2017, when CompositionEvent is supported by many major browsers, I thought it would be easy to implement a small input completion function that supports Japanese input in JavaScript, but the details of the implementation differed depending on the browser...">
<meta property="og:type" content="article">
<meta property="og:url" content="https://tanishiking.github.io/posts/sample/"><meta property="article:section" content="posts">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="IME event handling in JavaScript cross-browser (2017)">
<meta name=twitter:description content="In 2017, when CompositionEvent is supported by many major browsers, I thought it would be easy to implement a small input completion function that supports Japanese input in JavaScript, but the details of the implementation differed depending on the browser...">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tanishiking.github.io/posts/"},{"@type":"ListItem","position":2,"name":"IME event handling in JavaScript cross-browser (2017)","item":"https://tanishiking.github.io/posts/sample/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"IME event handling in JavaScript cross-browser (2017)","name":"IME event handling in JavaScript cross-browser (2017)","description":"In 2017, when CompositionEvent is supported by many major browsers, I thought it would be easy to implement a small input completion function that supports Japanese input in JavaScript, but the details of the implementation differed depending on the browser...","keywords":["javascript"],"articleBody":"In 2017, when CompositionEvent is supported by many major browsers, I thought it would be easy to implement a small input completion function that supports Japanese input in JavaScript. However, the details of the implementation differed depending on the browser, and I had to do a little workaround.\nTest environment  Windows 10 / Microsoft Edge 41.16299.150 Windows10 / InternetExplorer11 version: 11.64.16299.0 macOS Sierra 10.12.6 / Google Chrome version: 63.0.3239.84 macOS Sierra 10.12.6 / Safari version: 11.0.2 macOS Sierra 10.12.6 / Opera version: 49.0.2725.64 macOS Sierra 10.12.6 / Firefox Quantum version: 57.0.1  KeyboardEvent.keyCode For IME text editing, the KeyboardEvent.keyCode fired by the keyodown event is 229. This can be used to control the process triggered by the keydown event during text editing by IME.\neditorElem.addEventListener('keydown', function(event) {  if (event.keyCode ! == 229) {  // do something ...  } }); https://www.w3.org/TR/uievents/#determine-keydown-keyup-keyCode\n If an Input Method Editor is processing key input and the event is keydown, return 229.\n Gecko It seems that text editing by IME doesnâ€™t fire keydown/keyup events in Gecko.\nhttps://bugzilla.mozilla.org/show_bug.cgi?id=354358\nUpdate: this issue has already fixed in the end of 2018 ðŸŽ‰.\ndeprecated The KeyboardEvent.keyCode seems to be deprecated, and the keyCode attribute was mentioned in the Legacy Key Attributes section of the W3C, so maybe the keyCode is a platform/implementation dependent value that we want to get rid of.\nhttps://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode\nKeyboardEvent.isComposing. https://developer.mozilla.org/en/docs/Web/API/KeyboardEvent/isComposing\n A readonly attribute that is true for text composition by text composition system such as IME.  true if the event is fired between compositionstart and compositionend as described below.   Browser compatibility  Although MDNâ€™s Browser compatibility says that IE and Safari (on desktop) are not supported, we were able to get the value of KeyboardEvent.isComposing in Safari 11.0.2. On Microsoft Edge 41 and IE11, KeyboardEvent.isComposing seemed to be undefined.    I suppose it would be better to use this in the future, but since it is not yet supported in IE and Edge, it is not likely to be used yetâ€¦\nCompositionEvent https://developer.mozilla.org/en-US/docs/Web/API/CompositionEvent\n compositionstart: Fired when IME starts editing text. compositionupdate: Fired when the text being edited by IME is changed. compostionend: Fires when the IME finishes editing text.    According to MDNâ€™s Browser compatibility, Opera is not supported and Safari is ? According to MDN Browser compatibility, Opera is not supported, Safari is ?  However, the data attribute is not yet implemented.   To check if InputEvent is being edited by IME, instead of using InputEvent.isComposing, it would be better to monitor CompostionEvent and manage its state.  var isComposing = false;  editorElem.addEventListener('input', function(event) {  if (!isComposing) {  // do something ...  } }); editorElem.addEventListener('compostionstart', function(event) {  isComposing = true; }); editorElem.addEventListener('compostionstart', function(event) {  isComposing = false; }); Easy peasy.\nCompositionEvent/InputEvent firing order For more information.\n [https://www.w3.org/TR/input-events-2/#event-order-during-ime-composition] [https://www.w3.org/TR/uievents/#events-composition-input-events]  Start/edit text editing with IME.    event note     compositionstart start editing   beforeinput    compositionupdate     DOM is updated here   input     When text editing is finished    event note     compositionend    beforeinput     COM is updated here   input     Since the order of firing of events is like this, InputEvent during text editing by IME always fires between compositionstart and compositionend.\nI checked it. I wrote an experimental script and checked it with the browsers in the verification environment\n IE11, Edge41: The input event at the end of text editing does not seem to fire? Google Chrome, Safari, Opera: The input event at the end of text editing fires before the compositionend?  Iâ€™m not sure if itâ€™s just my scripting style. Please tell me if itâ€™s just my scripting.\nCompositionEvent/KeyboardEvent firing order For details, see [https://www.w3.org/TR/uievents/#events-composition-key-events]\nStart/stop editing text with IME.    event note     keydown    compositionstart start editing   compositionupdate    keyup     When text editing is finished    event note     keydown    compositionend    input    keyup     Iâ€™ve checked it out.  Firefox: As I mentioned at the beginning, IME editing does not fire keydown/keyup events [https://bugzilla.mozilla.org/show_bug.cgi?id=354358]. Safari: keydown fires after compositionend when text editing ends (keyCode in this case is 229) Edge: Neither keydown nor keyup fires at the end of text editing  Currently, it seems that the order of event firing is quite different depending on the browser implementationâ€¦ I donâ€™t think Iâ€™ll be using this much, but Iâ€™m glad to see that https://www.stum.de/2016/06/24/handling-ime-events-in-javascript/ has a detailed workaround for absorbing differences in event firing order between browsers. I donâ€™t think Iâ€™ll use it much, but the workaround for absorbing differences in event firing order between browsers is detailed in [].\nReference  https://www.w3.org/TR/uievents/ https://www.stum.de/2016/06/24/handling-ime-events-in-javascript/ https://docs.google.com/document/d/1pGo9hmOXCu71lnpXbqpTQNQP70DU9E-1tNN3yEWg5ig/edit/  Summary Currently, itâ€™s pretty complicated when it comes to browser compatibility, and even in 2017, Japanese input is still difficult.\n","wordCount":"737","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Rikito Taniguchi"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tanishiking.github.io/posts/sample/"},"publisher":{"@type":"Organization","name":"Rikito Taniguchi","logo":{"@type":"ImageObject","url":"https://tanishiking.github.io/favicon.ico"}}}</script>
</head><body id=top>
<script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://tanishiking.github.io/ accesskey=h title="Rikito Taniguchi (Alt + H)">Rikito Taniguchi</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div><ul id=menu>
<li>
<a href=https://tanishiking.github.io/cv/ title=CV>
<span>CV</span>
</a>
</li><li>
<a href=https://tanishiking.github.io/tags/ title=Tags>
<span>Tags</span>
</a>
</li></ul></nav></header><main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://tanishiking.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://tanishiking.github.io/posts/>Posts</a></div><h1 class=post-title>
IME event handling in JavaScript cross-browser (2017)
</h1><div class=post-description>
In 2017, when CompositionEvent is supported by many major browsers, I thought it would be easy to implement a small input completion function that supports Japanese input in JavaScript, but the details of the implementation differed depending on the browser...
</div><div class=post-meta>Rikito Taniguchi
</div></header><div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#test-environment aria-label="Test environment">Test environment</a></li><li>
<a href=#keyboardeventkeycode aria-label=KeyboardEvent.keyCode>KeyboardEvent.keyCode</a><ul>
<li>
<a href=#gecko aria-label=Gecko>Gecko</a></li><li>
<a href=#deprecated aria-label=deprecated>deprecated</a></li></ul></li><li>
<a href=#keyboardeventiscomposing aria-label=KeyboardEvent.isComposing.>KeyboardEvent.isComposing.</a></li><li>
<a href=#compositionevent aria-label=CompositionEvent>CompositionEvent</a></li><li>
<a href=#compositioneventinputevent-firing-order aria-label="CompositionEvent/InputEvent firing order">CompositionEvent/InputEvent firing order</a></li><li>
<a href=#startedit-text-editing-with-ime aria-label="Start/edit text editing with IME.">Start/edit text editing with IME.</a><ul>
<li>
<a href=#when-text-editing-is-finished aria-label="When text editing is finished">When text editing is finished</a><ul>
<li>
<a href=#i-checked-it aria-label="I checked it.">I checked it.</a></li></ul></li></ul></li><li>
<a href=#compositioneventkeyboardevent-firing-order aria-label="CompositionEvent/KeyboardEvent firing order">CompositionEvent/KeyboardEvent firing order</a><ul>
<li>
<a href=#startstop-editing-text-with-ime aria-label="Start/stop editing text with IME.">Start/stop editing text with IME.</a></li><li>
<a href=#when-text-editing-is-finished-1 aria-label="When text editing is finished">When text editing is finished</a></li><li>
<a href=#ive-checked-it-out aria-label="I&amp;rsquo;ve checked it out.">I&rsquo;ve checked it out.</a></li></ul></li><li>
<a href=#reference aria-label=Reference>Reference</a></li><li>
<a href=#summary aria-label=Summary>Summary</a>
</li></ul></div></details>
</div><div class=post-content><p>In 2017, when CompositionEvent is supported by many major browsers, I thought it would be easy to implement a small input completion function that supports Japanese input in JavaScript. However, the details of the implementation differed depending on the browser, and I had to do a little workaround.</p><h2 id=test-environment>Test environment<a hidden class=anchor aria-hidden=true href=#test-environment>#</a></h2><ul>
<li>Windows 10 / Microsoft Edge 41.16299.150</li><li>Windows10 / InternetExplorer11 version: 11.64.16299.0</li><li>macOS Sierra 10.12.6 / Google Chrome version: 63.0.3239.84</li><li>macOS Sierra 10.12.6 / Safari version: 11.0.2</li><li>macOS Sierra 10.12.6 / Opera version: 49.0.2725.64</li><li>macOS Sierra 10.12.6 / Firefox Quantum version: 57.0.1</li></ul><h2 id=keyboardeventkeycode>KeyboardEvent.keyCode<a hidden class=anchor aria-hidden=true href=#keyboardeventkeycode>#</a></h2><p>For IME text editing, the <code>KeyboardEvent.keyCode</code> fired by the <code>keyodown</code> event is <code>229</code>.
This can be used to control the process triggered by the <code>keydown</code> event during text editing by IME.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>editorElem</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;keydown&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>event</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>keyCode</span> <span style=color:#f92672>!</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>229</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// do something ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p><a href=https://www.w3.org/TR/uievents/#determine-keydown-keyup-keyCode>https://www.w3.org/TR/uievents/#determine-keydown-keyup-keyCode</a></p><blockquote>
<p>If an Input Method Editor is processing key input and the event is keydown, return 229.</p></blockquote><h3 id=gecko>Gecko<a hidden class=anchor aria-hidden=true href=#gecko>#</a></h3><p>It seems that text editing by IME doesn&rsquo;t fire keydown/keyup events in Gecko.</p><p><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=354358">https://bugzilla.mozilla.org/show_bug.cgi?id=354358</a></p><p>Update: this issue has already fixed in the end of 2018 ðŸŽ‰.</p><h3 id=deprecated>deprecated<a hidden class=anchor aria-hidden=true href=#deprecated>#</a></h3><p>The <code>KeyboardEvent.keyCode</code> seems to be deprecated, and the <code>keyCode</code> attribute was mentioned in the <code>Legacy Key Attributes</code> section of the W3C, so maybe the <code>keyCode</code> is a platform/implementation dependent value that we want to get rid of.</p><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode>https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode</a></p><h2 id=keyboardeventiscomposing>KeyboardEvent.isComposing.<a hidden class=anchor aria-hidden=true href=#keyboardeventiscomposing>#</a></h2><p><a href=https://developer.mozilla.org/en/docs/Web/API/KeyboardEvent/isComposing>https://developer.mozilla.org/en/docs/Web/API/KeyboardEvent/isComposing</a></p><ul>
<li>A readonly attribute that is <code>true</code> for text composition by <a href=https://www.w3.org/TR/uievents/#text-composition-system>text composition system</a> such as IME.
<ul>
<li><code>true</code> if the event is fired between <code>compositionstart</code> and <code>compositionend</code> as described below.</li></ul></li><li>Browser compatibility
<ul>
<li>Although MDN&rsquo;s Browser compatibility says that IE and Safari (on desktop) are not supported, we were able to get the value of <code>KeyboardEvent.isComposing</code> in Safari 11.0.2.</li><li>On Microsoft Edge 41 and IE11, <code>KeyboardEvent.isComposing</code> seemed to be <code>undefined</code>.</li></ul></li></ul><p>I suppose it would be better to use this in the future, but since it is not yet supported in IE and Edge, it is not likely to be used yet&mldr;</p><h2 id=compositionevent>CompositionEvent<a hidden class=anchor aria-hidden=true href=#compositionevent>#</a></h2><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/CompositionEvent>https://developer.mozilla.org/en-US/docs/Web/API/CompositionEvent</a></p><ul>
<li><code>compositionstart</code>: Fired when IME starts editing text.</li><li><code>compositionupdate</code>: Fired when the text being edited by IME is changed.</li><li><code>compostionend</code>: Fires when the IME finishes editing text.</li></ul><hr>
<ul>
<li>According to MDN&rsquo;s Browser compatibility, Opera is not supported and Safari is <code>? According to MDN Browser compatibility, Opera is not supported, Safari is </code>?
<ul>
<li>However, the <code>data</code> attribute is not yet implemented.</li></ul></li><li>To check if <code>InputEvent</code> is being edited by IME, instead of using <code>InputEvent.isComposing</code>, it would be better to monitor CompostionEvent and manage its state.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>isComposing</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>editorElem</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;input&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>event</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isComposing</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// do something ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span><span style=color:#a6e22e>editorElem</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;compostionstart&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>event</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>isComposing</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span><span style=color:#a6e22e>editorElem</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;compostionstart&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>event</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>isComposing</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>Easy peasy.</p><h2 id=compositioneventinputevent-firing-order>CompositionEvent/InputEvent firing order<a hidden class=anchor aria-hidden=true href=#compositioneventinputevent-firing-order>#</a></h2><p>For more information.</p><ul>
<li>[https://www.w3.org/TR/input-events-2/#event-order-during-ime-composition]</li><li>[https://www.w3.org/TR/uievents/#events-composition-input-events]</li></ul><h2 id=startedit-text-editing-with-ime>Start/edit text editing with IME.<a hidden class=anchor aria-hidden=true href=#startedit-text-editing-with-ime>#</a></h2><table>
<thead>
<tr>
<th>event</th><th>note</th></tr></thead><tbody>
<tr>
<td>compositionstart</td><td>start editing</td></tr><tr>
<td>beforeinput</td><td></td></tr><tr>
<td>compositionupdate</td><td></td></tr><tr>
<td></td><td>DOM is updated here</td></tr><tr>
<td>input</td><td></td></tr></tbody></table><h3 id=when-text-editing-is-finished>When text editing is finished<a hidden class=anchor aria-hidden=true href=#when-text-editing-is-finished>#</a></h3><table>
<thead>
<tr>
<th>event</th><th>note</th></tr></thead><tbody>
<tr>
<td>compositionend</td><td></td></tr><tr>
<td>beforeinput</td><td></td></tr><tr>
<td></td><td>COM is updated here</td></tr><tr>
<td>input</td><td></td></tr></tbody></table><p>Since the order of firing of events is like this, <code>InputEvent</code> during text editing by IME always fires between <code>compositionstart</code> and <code>compositionend</code>.</p><h4 id=i-checked-it>I checked it.<a hidden class=anchor aria-hidden=true href=#i-checked-it>#</a></h4><p>I wrote an experimental script and checked it with the browsers in the verification environment</p><ul>
<li>IE11, Edge41: The <code>input</code> event at the end of text editing does not seem to fire?</li><li>Google Chrome, Safari, Opera: The <code>input</code> event at the end of text editing fires before the <code>compositionend</code>?</li></ul><p>I&rsquo;m not sure if it&rsquo;s just my scripting style. Please tell me if it&rsquo;s just my scripting.</p><h2 id=compositioneventkeyboardevent-firing-order>CompositionEvent/KeyboardEvent firing order<a hidden class=anchor aria-hidden=true href=#compositioneventkeyboardevent-firing-order>#</a></h2><p>For details, see [https://www.w3.org/TR/uievents/#events-composition-key-events]</p><h3 id=startstop-editing-text-with-ime>Start/stop editing text with IME.<a hidden class=anchor aria-hidden=true href=#startstop-editing-text-with-ime>#</a></h3><table>
<thead>
<tr>
<th>event</th><th>note</th></tr></thead><tbody>
<tr>
<td>keydown</td><td></td></tr><tr>
<td>compositionstart</td><td>start editing</td></tr><tr>
<td>compositionupdate</td><td></td></tr><tr>
<td>keyup</td><td></td></tr></tbody></table><h3 id=when-text-editing-is-finished-1>When text editing is finished<a hidden class=anchor aria-hidden=true href=#when-text-editing-is-finished-1>#</a></h3><table>
<thead>
<tr>
<th>event</th><th>note</th></tr></thead><tbody>
<tr>
<td>keydown</td><td></td></tr><tr>
<td>compositionend</td><td></td></tr><tr>
<td>input</td><td></td></tr><tr>
<td>keyup</td><td></td></tr></tbody></table><h3 id=ive-checked-it-out>I&rsquo;ve checked it out.<a hidden class=anchor aria-hidden=true href=#ive-checked-it-out>#</a></h3><ul>
<li>Firefox: As I mentioned at the beginning, IME editing does not fire keydown/keyup events [https://bugzilla.mozilla.org/show_bug.cgi?id=354358].</li><li>Safari: <code>keydown</code> fires after <code>compositionend</code> when text editing ends (<code>keyCode</code> in this case is 229)</li><li>Edge: Neither <code>keydown</code> nor <code>keyup</code> fires at the end of text editing</li></ul><p>Currently, it seems that the order of event firing is quite different depending on the browser implementation&mldr; I don&rsquo;t think I&rsquo;ll be using this much, but I&rsquo;m glad to see that <a href=https://www.stum.de/2016/06/24/handling-ime-events-in-javascript/>https://www.stum.de/2016/06/24/handling-ime-events-in-javascript/</a> has a detailed workaround for absorbing differences in event firing order between browsers. I don&rsquo;t think I&rsquo;ll use it much, but the workaround for absorbing differences in event firing order between browsers is detailed in [].</p><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><ul>
<li><a href=https://www.w3.org/TR/uievents/>https://www.w3.org/TR/uievents/</a></li><li><a href=https://www.stum.de/2016/06/24/handling-ime-events-in-javascript/>https://www.stum.de/2016/06/24/handling-ime-events-in-javascript/</a></li><li><a href=https://docs.google.com/document/d/1pGo9hmOXCu71lnpXbqpTQNQP70DU9E-1tNN3yEWg5ig/edit/>https://docs.google.com/document/d/1pGo9hmOXCu71lnpXbqpTQNQP70DU9E-1tNN3yEWg5ig/edit/</a></li></ul><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><p>Currently, it&rsquo;s pretty complicated when it comes to browser compatibility, and even in 2017, Japanese input is still difficult.</p></div><footer class=post-footer>
<ul class=post-tags>
<li><a href=https://tanishiking.github.io/tags/javascript/>javascript</a></li></ul></footer></article></main><footer class=footer>
<span>&copy; 2022 <a href=https://tanishiking.github.io/>Rikito Taniguchi</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script>
</body></html>